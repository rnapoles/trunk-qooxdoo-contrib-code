<?xml version="1.0" encoding="utf-8"?>
<qxt:component
  xmlns:qx="http://www.qxtransformer.org/qooxdoo/0.8"
  xmlns:qxt="http://www.qxtransformer.org/extension/0.4"
  xmlns:qcl="http://www.qooxdoo.org/contrib/qcl/trunk"
  author="Christian Boulanger"
  className="access.components.ToolBar"
  tagName="toolBar">

  <qx:toolBar>
  
    <qx:toolBarPart>

      <qx:toolBarButton 
        id="loginButton"      
        label="Login" icon="icon/16/status/dialog-password.png"
        visibility="excluded">
        
        <!-- show button only when user is not logged in -->
        <qcl:observe 

          property="visibility" 
          source="this.getApplication().getUserManager()"
          sourceProp="activeUser"
          converter="function(activeUser){ return ( ! activeUser || activeUser.isAnonymous() ) ? 'visible' : 'excluded' }" />
          
        <qxt:listener type="execute">
          qcl.components.login.Popup.getInstance().show();
        </qxt:listener>
        
      </qx:toolBarButton>

      <qx:toolBarButton 
        id="logoutButton"
        label="Logout" icon="icon/16/actions/application-exit.png"
        visibility="excluded">
        
        <!-- show button only when user is logged in -->
        <qcl:observe 
          property="visibility" 
          source="loginButton"
          sourceProp="visibility"
          converter="function(visibility){ return ( visibility == 'visible' ) ? 'excluded' : 'visible' }" />
          
        <qxt:listener type="execute">
          this.getApplication().logout();
        </qxt:listener>
        
      </qx:toolBarButton>

      <qx:atom 
        label="Loading..." 
        icon="icon/22/apps/preferences-users.png">
      
        <qcl:observe 
          property="label" 
          source="this.getApplication().getUserManager()"
          sourceProp="activeUser.fullname" />
      
      </qx:atom>
    </qx:toolBarPart>
    
    <qx:toolBarPart>

      <qx:toolBarMenuButton label="Server" >
        <qx:menu>
           <qx:radioGroup>
            <qx:menuRadioButton label="Use RpcPhp 1.0" value="true">
              <qxt:listener event="changeValue">
                if(e.getData())
                {
                  this.getApplication().useServer("1.0");
                }
              </qxt:listener>
            </qx:menuRadioButton>
            <qx:menuRadioButton label="Use qcl server" >
              <qxt:listener event="changeValue" arg="event">
                if(event.getData())
                {
                  this.getApplication().useServer("qcl");
                }
              </qxt:listener>
            </qx:menuRadioButton>
          </qx:radioGroup>
        </qx:menu>
      </qx:toolBarMenuButton>
      
   </qx:toolBarPart>  
  </qx:toolBar>
  
</qxt:component>