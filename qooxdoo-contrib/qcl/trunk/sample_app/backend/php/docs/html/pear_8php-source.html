<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>qcl sample application: F:/xampp/htdocs/qooxdoo-contrib/qcl/trunk/sample_app/backend/php/services/qcl/jsonrpc/db/pear.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<h1>F:/xampp/htdocs/qooxdoo-contrib/qcl/trunk/sample_app/backend/php/services/qcl/jsonrpc/db/pear.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00008"></a>00008 require_once SERVICE_PATH . <span class="stringliteral">"qcl/jsonrpc/db.php"</span>;
<a name="l00009"></a>00009 
<a name="l00010"></a><a class="code" href="classqcl__jsonrpc__db__pear.html">00010</a> <span class="keyword">class </span><a class="code" href="classqcl__jsonrpc__db__pear.html">qcl_jsonrpc_db_pear</a> <span class="keyword">extends</span> <a class="code" href="classqcl__jsonrpc__db.html">qcl_jsonrpc_db</a> 
<a name="l00011"></a>00011 {
<a name="l00012"></a>00012 
<a name="l00016"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#63efb2ad590ce75eb80e90d18a60b32b">00016</a>         function <a class="code" href="classqcl__jsonrpc__db__pear.html#63efb2ad590ce75eb80e90d18a60b32b">__construct</a>()
<a name="l00017"></a>00017         {
<a name="l00018"></a>00018                 parent::__construct();
<a name="l00019"></a>00019         }
<a name="l00020"></a>00020 
<a name="l00021"></a>00021         
<a name="l00025"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#89e16b98ad796d9fbcea4a2b0dd89a7d">00025</a>         function &amp;<a class="code" href="classqcl__jsonrpc__db__pear.html#89e16b98ad796d9fbcea4a2b0dd89a7d">connect</a>()
<a name="l00026"></a>00026         {
<a name="l00027"></a>00027                 require_once <span class="stringliteral">"DB.php"</span>; <span class="comment">// load pear DB library</span>
<a name="l00028"></a>00028                 <a class="code" href="classqcl__jsonrpc__db.html#97eb877110c094fbf2e195052574d84a">$db</a> =&amp; DB::connect( $this-&gt;dsn );
<a name="l00029"></a>00029                 <span class="keywordflow">if</span> (PEAR::isError(<a class="code" href="classqcl__jsonrpc__db.html#97eb877110c094fbf2e195052574d84a">$db</a>)) 
<a name="l00030"></a>00030                 {
<a name="l00031"></a>00031                         $this-&gt;<a class="code" href="classqcl__jsonrpc__object.html#c1504e87fd3e1638ab83e5f1b0d7b440">raiseError</a>( $res-&gt;getMessage() . <span class="stringliteral">": "</span> . $res-&gt;getUserInfo() );
<a name="l00032"></a>00032                 }
<a name="l00033"></a>00033                 <a class="code" href="classqcl__jsonrpc__db.html#97eb877110c094fbf2e195052574d84a">$db</a>-&gt;setFetchMode(DB_FETCHMODE_ASSOC);
<a name="l00034"></a>00034                 
<a name="l00035"></a>00035                 <span class="comment">// set encoding</span>
<a name="l00036"></a>00036                 $encoding = $this-&gt;config['database']['encoding']; 
<a name="l00037"></a>00037                 <span class="keywordflow">if</span> ($encoding)
<a name="l00038"></a>00038                 {
<a name="l00039"></a>00039                         <a class="code" href="classqcl__jsonrpc__db.html#97eb877110c094fbf2e195052574d84a">$db</a>-&gt;query(<span class="stringliteral">"SET NAMES $encoding"</span>);
<a name="l00040"></a>00040                         <a class="code" href="classqcl__jsonrpc__db.html#97eb877110c094fbf2e195052574d84a">$db</a>-&gt;query(<span class="stringliteral">"SET CHARACTER_SET $encoding"</span>);
<a name="l00041"></a>00041                 }
<a name="l00042"></a>00042                 
<a name="l00043"></a>00043                 <span class="keywordflow">return</span> <a class="code" href="classqcl__jsonrpc__db.html#97eb877110c094fbf2e195052574d84a">$db</a>;
<a name="l00044"></a>00044         }
<a name="l00045"></a>00045         
<a name="l00046"></a>00046         
<a name="l00050"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#01cadf900e8eefb1d9e9fc64411c720a">00050</a>         function &amp;<a class="code" href="classqcl__jsonrpc__db__pear.html#01cadf900e8eefb1d9e9fc64411c720a">query</a> ( $sql )
<a name="l00051"></a>00051         {
<a name="l00052"></a>00052                 global <a class="code" href="classqcl__jsonrpc__object.html#db5650f9425bae0d4eae282f6b018e7a">$error</a>;
<a name="l00053"></a>00053                 $res = $this-&gt;db-&gt;query( $sql );
<a name="l00054"></a>00054                 <span class="keywordflow">if</span> (PEAR::isError($res)) {
<a name="l00055"></a>00055                         $this-&gt;<a class="code" href="classqcl__jsonrpc__object.html#c1504e87fd3e1638ab83e5f1b0d7b440">raiseError</a>( $res-&gt;getMessage() . <span class="stringliteral">": "</span> . $res-&gt;getUserInfo() );
<a name="l00056"></a>00056                 }
<a name="l00057"></a>00057                 <span class="keywordflow">return</span> $res;
<a name="l00058"></a>00058         }
<a name="l00059"></a>00059         
<a name="l00063"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#ac53b36035a6607877777c8d3b2528a1">00063</a>         function &amp;<a class="code" href="classqcl__jsonrpc__db__pear.html#ac53b36035a6607877777c8d3b2528a1">execute</a> ( $sql )
<a name="l00064"></a>00064         {
<a name="l00065"></a>00065                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classqcl__jsonrpc__db__pear.html#01cadf900e8eefb1d9e9fc64411c720a">query</a> ( $sql );   
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067 
<a name="l00071"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#827e39f134a76367a9e038a13317f7af">00071</a>         function &amp;<a class="code" href="classqcl__jsonrpc__db__pear.html#827e39f134a76367a9e038a13317f7af">getRow</a> ( $sql )
<a name="l00072"></a>00072         {
<a name="l00073"></a>00073                 $res = $this-&gt;db-&gt;getRow( $sql );
<a name="l00074"></a>00074                 <span class="keywordflow">if</span> ( PEAR::isError ( $res ) ) {
<a name="l00075"></a>00075                         $this-&gt;<a class="code" href="classqcl__jsonrpc__object.html#c1504e87fd3e1638ab83e5f1b0d7b440">raiseError</a>( $res-&gt;getMessage() . <span class="stringliteral">": "</span> . $res-&gt;getUserInfo() );
<a name="l00076"></a>00076                 }
<a name="l00077"></a>00077                 <span class="keywordflow">return</span> $res;            
<a name="l00078"></a>00078         }       
<a name="l00079"></a>00079         
<a name="l00083"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#2619b33bb907ec7909c8ef0fa2a4fd3a">00083</a>         function &amp;<a class="code" href="classqcl__jsonrpc__db__pear.html#2619b33bb907ec7909c8ef0fa2a4fd3a">getAllRows</a> ( $sql )
<a name="l00084"></a>00084         {
<a name="l00085"></a>00085                 $res = $this-&gt;db-&gt;getAll( $sql );
<a name="l00086"></a>00086                 <span class="keywordflow">if</span> ( PEAR::isError ( $res ) ) {
<a name="l00087"></a>00087                         $this-&gt;<a class="code" href="classqcl__jsonrpc__object.html#c1504e87fd3e1638ab83e5f1b0d7b440">raiseError</a>( $res-&gt;getMessage() . <span class="stringliteral">": "</span> . $res-&gt;getUserInfo() );
<a name="l00088"></a>00088                 }
<a name="l00089"></a>00089                 <span class="keywordflow">return</span> $res;
<a name="l00090"></a>00090         }
<a name="l00091"></a>00091         
<a name="l00098"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#4f82d20f88a095775e43757d172ac0c1">00098</a>         function <a class="code" href="classqcl__jsonrpc__db__pear.html#4f82d20f88a095775e43757d172ac0c1">insert</a> ( $table, $data ) 
<a name="l00099"></a>00099         {
<a name="l00100"></a>00100                 $columns = implode(<span class="stringliteral">"`,`"</span>, array_keys($data) );
<a name="l00101"></a>00101                 $values  = array();
<a name="l00102"></a>00102                 
<a name="l00103"></a>00103                 <span class="keywordflow">foreach</span> ( array_values($data) as $value )
<a name="l00104"></a>00104                 {
<a name="l00105"></a>00105                         <span class="keywordflow">if</span> ( is_numeric($value) )
<a name="l00106"></a>00106                         {
<a name="l00107"></a>00107                                 $values[] = $value;
<a name="l00108"></a>00108                         }       
<a name="l00109"></a>00109                         <span class="keywordflow">else</span>
<a name="l00110"></a>00110                         {
<a name="l00111"></a>00111                                 $values[] = <span class="stringliteral">"'"</span> . $this-&gt;<a class="code" href="classqcl__jsonrpc__db__pear.html#80a86cd4f12f83e2615869eac09682b9">escape</a>( $value ) . <span class="stringliteral">"'"</span>;        
<a name="l00112"></a>00112                         }
<a name="l00113"></a>00113                 }
<a name="l00114"></a>00114                 $values = implode (<span class="stringliteral">","</span>, $values );
<a name="l00115"></a>00115                 
<a name="l00116"></a>00116                 $this-&gt;<a class="code" href="classqcl__jsonrpc__db__pear.html#01cadf900e8eefb1d9e9fc64411c720a">query</a> ( utf8_decode(<span class="stringliteral">"</span>
<a name="l00117"></a>00117 <span class="stringliteral">                        INSERT INTO </span>
<a name="l00118"></a>00118 <span class="stringliteral">                                `$table` (`$columns`) </span>
<a name="l00119"></a>00119 <span class="stringliteral">                        VALUES ($values)</span>
<a name="l00120"></a>00120 <span class="stringliteral">                "</span>));
<a name="l00121"></a>00121                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classqcl__jsonrpc__db__pear.html#2e1997985041069fc356e5f58aa6e9b4">getLastInsertId</a>();
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123 
<a name="l00130"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#679b42ce1b9b077fa6860f15f8f8abad">00130</a>         function <a class="code" href="classqcl__jsonrpc__db__pear.html#679b42ce1b9b077fa6860f15f8f8abad">update</a> ( $table, $data, $idColumn=<span class="stringliteral">"id"</span> )
<a name="l00131"></a>00131         {
<a name="l00132"></a>00132                 $id              = $data[$idColumn];
<a name="l00133"></a>00133                 unset($data[$idColumn]);
<a name="l00134"></a>00134                 
<a name="l00135"></a>00135                 $pairs   = array();
<a name="l00136"></a>00136                 
<a name="l00137"></a>00137                 <span class="keywordflow">foreach</span> ( $data as $key =&gt; $value )
<a name="l00138"></a>00138                 {
<a name="l00139"></a>00139                         $pairs[] = <span class="stringliteral">"`$key` = '"</span> . $this-&gt;<a class="code" href="classqcl__jsonrpc__db__pear.html#80a86cd4f12f83e2615869eac09682b9">escape</a>( $value ) . <span class="stringliteral">"'"</span>;
<a name="l00140"></a>00140                 }
<a name="l00141"></a>00141                 $pairs = implode (<span class="stringliteral">","</span> , $pairs );
<a name="l00142"></a>00142                 
<a name="l00143"></a>00143                 $this-&gt;<a class="code" href="classqcl__jsonrpc__db__pear.html#01cadf900e8eefb1d9e9fc64411c720a">query</a> ( utf8_decode(<span class="stringliteral">"</span>
<a name="l00144"></a>00144 <span class="stringliteral">                        UPDATE `$table` </span>
<a name="l00145"></a>00145 <span class="stringliteral">                        SET $pairs</span>
<a name="l00146"></a>00146 <span class="stringliteral">                        WHERE `$idColumn` = $id</span>
<a name="l00147"></a>00147 <span class="stringliteral">                "</span>));
<a name="l00148"></a>00148         }
<a name="l00149"></a>00149 
<a name="l00156"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#9fcea29dbd9f80b2162dfd7e63a42436">00156</a>         function <span class="keyword">delete</span> ( $table, $ids, $idColumn=<span class="stringliteral">"id"</span> ) 
<a name="l00157"></a>00157         {               
<a name="l00158"></a>00158                 $id_list = implode(<span class="stringliteral">","</span>, (array) $ids );
<a name="l00159"></a>00159                 $this-&gt;<a class="code" href="classqcl__jsonrpc__db__pear.html#01cadf900e8eefb1d9e9fc64411c720a">query</a> (<span class="stringliteral">"</span>
<a name="l00160"></a>00160 <span class="stringliteral">                        DELETE FROM `$table` </span>
<a name="l00161"></a>00161 <span class="stringliteral">                        WHERE `$idColumn` IN ($id_list)</span>
<a name="l00162"></a>00162 <span class="stringliteral">                "</span>);
<a name="l00163"></a>00163         }
<a name="l00164"></a>00164         
<a name="l00168"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#80a86cd4f12f83e2615869eac09682b9">00168</a>         function <a class="code" href="classqcl__jsonrpc__db__pear.html#80a86cd4f12f83e2615869eac09682b9">escape</a> ( $string )
<a name="l00169"></a>00169         {
<a name="l00170"></a>00170                 <span class="keywordflow">return</span> $this-&gt;db-&gt;escapeSimple( $string );
<a name="l00171"></a>00171         }
<a name="l00172"></a>00172         
<a name="l00176"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#2e1997985041069fc356e5f58aa6e9b4">00176</a>         function <a class="code" href="classqcl__jsonrpc__db__pear.html#2e1997985041069fc356e5f58aa6e9b4">getLastInsertId</a>()
<a name="l00177"></a>00177         {
<a name="l00178"></a>00178                 $res = $this-&gt;db-&gt;getRow(<span class="stringliteral">"SELECT last_insert_id()"</span>, DB_FETCHMODE_ORDERED );
<a name="l00179"></a>00179                 <span class="keywordflow">return</span> $res[0];
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181         
<a name="l00185"></a><a class="code" href="classqcl__jsonrpc__db__pear.html#ff78602da6ac80bbe63f461efd969e15">00185</a>         function <a class="code" href="classqcl__jsonrpc__db__pear.html#ff78602da6ac80bbe63f461efd969e15">disconnect</a>()
<a name="l00186"></a>00186         {
<a name="l00187"></a>00187                 $this-&gt;db-&gt;disconnect();
<a name="l00188"></a>00188         }
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 ?&gt;
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Mon Sep 10 08:50:44 2007 for qcl sample application by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
