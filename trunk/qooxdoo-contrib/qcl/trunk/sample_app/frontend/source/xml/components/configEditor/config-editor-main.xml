<?xml version="1.0" encoding="utf-8"?>
<qxt:include-definition
	xmlns:qx="http://www.qooxdoo.org"
	xmlns:qxt="http://www.qxtransformer.sourceforge.net/extension">
	
	<!-- authorization configuration -->
	
	<!-- includes -->
	<qxt:include src="/components/configEditor/config-editor-contextmenus.xml"/>

	<!-- SECURITY POLICIES -->
	
	<qx:security>
		<qx:permission name="qcl.config.permissions.manage" />
	</qx:security>
	
	<qx:window 
		id="configEditorWindow" 
		width="500" height="400" 
		caption="Edit Configuration"
		showMinimize="false" showClose="true" 
		modal="false" onAppear="this.centerToBrowser()">
		
		<qx:messageSubscriber filter="qcl.config.commands.editor.show">
			this.setDisplay(true);
			qx.event.message.Bus.dispatch("qcl.config.messages.editor.reload");
		</qx:messageSubscriber>
		
		<qx:messageSubscriber filter="qcl.auth.messages.logout">
			this.setDisplay(false);
		</qx:messageSubscriber>		
		 
		<qx:verticalBoxLayout dimension="100%,100%">
		
		<!-- toolbar -->
		<qx:toolBar width="100%" height="30">
	
				<qx:toolBarButton 
					text="Reload" 
					icon="icon/22/actions/view-refresh.png" 
					tooltip="Reload the data">
					<qx:eventListener type="execute" dispatchMessage="qcl.config.messages.editor.reload"/>
				</qx:toolBarButton>

				<qx:toolBarButton 
					text="New Key"
					icon="icon/22/apps/system-users.png" 
					enabled="false"
					enableOnPermission="qcl.config.permissions.editor.createKey">
					<qx:eventListener type="execute" dispatchMessage="qcl.config.messages.editor.createKey"/>
				</qx:toolBarButton>
								
				<qx:toolBarButton 
					text="Delete"
					icon="icon/22/actions/edit-delete.png"
					enabled="false"
					enableOnPermission="qcl.config.permissions.editor.deleteKey">
					<qx:eventListener type="execute" dispatchMessage="qcl.config.messages.editor.deleteKey"/>
				</qx:toolBarButton>				
				
		</qx:toolBar>		
		
		<qx:table  
			id="configEditorTable"
			dimension="100%,1*"
			tableModel="simple"
			columnVisibilityButtonVisible="false"
			keepFirstVisibleRowComplete="true"
			statusBarVisible="false"
			border="inset-thin"
			dataBinding="true">
				
			<qx:tableColumn label="ID"    display="false"/>
			<qx:tableColumn label="Name"  width="100"/>
			<qx:tableColumn label="Type"  width="100"/>
			<qx:tableColumn label="Value" width="100"/>
			<qx:tableColumn label="Read"  width="100"/>
			<qx:tableColumn label="Write" width="100"/>
			<qx:tableColumn label="User"  width="100" />
			
			<qx:messageSubscriber filter="qcl.config.messages.editor.reload">
				this.updateClient('sample_app.config.configManager.getAll');
			</qx:messageSubscriber>
			
			<!-- user has edited data, send data to server -->
			
			<qx:eventListener type="dataChanged" qxt:modifier=".getTableModel()" >
				<![CDATA[
				]]>
			</qx:eventListener>

		</qx:table>
		
		</qx:verticalBoxLayout>

	</qx:window>
	
</qxt:include-definition>