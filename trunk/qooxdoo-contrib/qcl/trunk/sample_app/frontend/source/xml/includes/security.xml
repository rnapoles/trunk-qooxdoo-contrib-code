<?xml version="1.0" encoding="utf-8"?>
<qxt:include-definition
	xmlns:qx="http://www.qooxdoo.org"
	xmlns:qxt="http://www.qxtransformer.sourceforge.net/extension"
	xmlns:qcl="http://qooxdoo-contrib.sourceforge.net/qcl">

	<!-- application security policies -->
	
	<qx:security>
		<!-- default permission for any user that can log in -->
		<qx:permission name="sample_app.permissions.default.*" />
	</qx:security>
	
	<!-- user/login manager -->
	
 	<qx:userManager
 		id="userManager" 
 		dataBinding="true" 
 		serviceName="sample_app.auth.user">
 
		<qx:messageSubscriber filter="qcl.auth.messages.loginAttempt">
			var username = message.getData().username;
			var password = message.getData().password; // todo: md5 with client-server salt sync 
			this.updateClient(username,password);
		</qx:messageSubscriber>
	
		<qx:messageSubscriber filter="qcl.auth.messages.loginSuccess">
			// show hidden panes on login
			qx.event.message.Bus.dispatch("sample_app.messages.panes.reload",true);
			qx.event.message.Bus.dispatch("sample_app.messages.application.show",true);
		</qx:messageSubscriber>
		
		<qx:messageSubscriber filter="sample_app.messages.logout">
			// logout and hide panes
			qcl.auth.user.Manager.getInstance().setActiveUser(null);
			qx.event.message.Bus.dispatch("sample_app.messages.application.show",false);
			this.updateServer("sample_app.auth.user.logout");
		</qx:messageSubscriber>
			
	</qx:userManager>
	
	<qxt:script>
		// start authentication
		userManager.updateClient();
	</qxt:script>
	
</qxt:include-definition>