<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script src="qx-bom.js" type="text/javascript" charset="utf-8"></script>
  
  <style type="text/css" media="screen">
    input {
        margin: 10px;
    }
    
    .ampel {
        width: 100px;
        height: 30px;
        padding: 3px;
        margin: 10px;
        border: 1px solid black;
        background-color: yellow;
    }

    .ok {
        background-color: green;
    }
    
  </style>
</head>
<body>
  <h1>Focus Demo</h1>

  <input type="text" name="" value="" id="ref">

  <br>
  <span id="ref_blur" class="ampel">blur on old</span>
  <span id="target_focus" class="ampel">focus on target</span>
  <span id="target_blur" class="ampel">blur on target</span>  
  
  <div id="target">
    
  </div>
  
  <input type="button" name="" value="Reset" id="reset">
  <h3>focus while hidden</h3>
  <input type="button" name="" value="Excluded" id="excluded">
  <input type="button" name="" value="Display None" id="display">
  <input type="button" name="" value="Visibility Hidden" id="hidden">

  <h3>focus while visible</h3>
  <input type="button" name="" value="Inserted" id="inserted">
  <input type="button" name="" value="Focus then exclude" id="focus_exclude">
  <input type="button" name="" value="Focus then Display None" id="focus_display">
  <input type="button" name="" value="Focus then Visibility Hidden" id="focus_hide">
      
  <script type="text/javascript" charset="utf-8">

var q = qx.bom.Collection.query;

function getFousedElement()
{
    var manager = qx.event.Registration.getManager(window);
    var focusHandler = manager.getHandler(qx.event.handler.Focus);
    return focusHandler.getFocus();
}

var target = document.getElementById("target");
ref = document.getElementById("ref");


function reset()
{
    ref.focus(); 
    target.innerHTML = "";
    
    q("#ref_blur").removeClass("ok");
    q("#target_focus").removeClass("ok");
    q("#target_blur").removeClass("ok");
}


function addListener(input)
{
    input.onblur = function() {
        q("#target_blur").addClass("ok");
    }
    input.onfocus = function() {
        q("#target_focus").addClass("ok");
    }    
}

function createInputelement()
{
    var el = document.createElement("input");
    el.type ="text";
    addListener(el);
    return el;
}

q("#reset").addListener("click", reset);
ref.onblur = function() {
    q("#ref_blur").addClass("ok");
}

/*
document.body.onkeypress = function(e) {
    var e = e || window.event;
    console.log(e.target);
}
*/

q("#excluded").addListener("click", function() {
    reset();
    var el = createInputelement();
    el.focus();
   
    target.appendChild(el);  
});


q("#display").addListener("click", function() {
    reset();
    var el = createInputelement();
    el.style.display = "none";

    target.appendChild(el);  

    el.focus();
    el.style.display = "inline";   
});

q("#hidden").addListener("click", function() {
    reset();
    var el = createInputelement();
    el.style.visibility = "hidden";

    target.appendChild(el);  

    el.focus();
    el.style.visibility = "";    
});


q("#inserted").addListener("click", function() {
    reset();
    var el = createInputelement();

    target.appendChild(el);  
    el.focus();
});

q("#focus_exclude").addListener("click", function() {
    reset();
    var el = createInputelement();

    target.appendChild(el);          

    el.focus();
    
    target.removeChild(el);
    target.appendChild(el);
    window.setTimeout(function() {
        target.appendChild(el);
    }, 0);
});

q("#focus_display").addListener("click", function() {
    reset();
    var el = createInputelement();

    target.appendChild(el);          

    el.focus();
    
    el.style.display = "none";
    window.setTimeout(function() {
        el.style.display = "inline";
    }, 0);
});

q("#focus_hide").addListener("click", function() {
    reset();
    var el = createInputelement();

    target.appendChild(el);          

    el.focus();
    
    el.style.visibility = "hidden";
    window.setTimeout(function() {
        el.style.visibility = "";
    }, 0); 
});

  </script>
</body>
</html>